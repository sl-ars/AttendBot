version: "3.9"

x-selenium-common: &selenium-common
  shm_size: 2gb
  restart: unless-stopped
  environment:
    - SE_NODE_MAX_SESSIONS=3
    - SE_NODE_OVERRIDE_MAX_SESSIONS=true
    - SE_START_XVFB=true
  networks:
    automation:
      aliases:
        - selenium    # app resolves http://selenium:4444

services:
  # ---- Use this on Intel/AMD hosts ----
  selenium-amd64:
    <<: *selenium-common
    image: selenium/standalone-chrome:latest
    platform: linux/amd64
    profiles: ["amd64"]

  # ---- Use this on Apple Silicon / ARM64 hosts ----
  selenium-arm64:
    <<: *selenium-common
    image: seleniarm/standalone-chromium:latest
    platform: linux/arm64
    profiles: ["arm64"]

  bot:
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    env_file:
      - .env
    environment:
      REMOTE_URL: ${REMOTE_URL:-http://selenium:4444/wd/hub}
      BASE_URL: ${BASE_URL:-https://wsp.kbtu.kz/RegistrationOnline}
      SEL_HOST: selenium
      SEL_PORT: "4444"
    networks:
      - automation
    profiles: ["amd64", "arm64"]
networks:
  automation:
    driver: bridge
